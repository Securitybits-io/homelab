entryPoints:
  http:
    address: :80
    http:
      redirections:
        entryPoint:
          scheme: https
          to: https
  https:
    address: :443
    asDefault: true
    http3: {}
    transport:
      respondingTimeouts:
        readTimeout: 300


http:
  routers:
    immich:
      rule: Host(`immich.securitybits.io`)
      entrypoints: websecure
      service: service-immich
      tls:
        certresolver: letsencrypt
      middlewares:
        - limitBodySize@file

    # microbin:
    #   rule: Host(`microbin.securitybits.io`)
    #   entrypoints: websecure
    #   service: service-microbin
    #   tls:
    #     certresolver: letsencrypt

    # dashboard:
    #   rule: Host(`dashboard.securitybits.io`)
    #   entrypoints: websecure
    #   service: service-internal-dashboard
    #   tls:
    #     certresolver: letsencrypt
    #   middlewares:
    #     - ip-whitelist

    nomad:
      rule: Host(`nomad.securitybits.io`)
      entrypoints: websecure
      service: service-nomad
      tls:
        certresolver: letsencrypt
      middlewares:
        - ip-whitelist

    consul:
      rule: Host(`consul.securitybits.io`)
      entrypoints: websecure
      service: service-consul
      tls:
        certresolver: letsencrypt    
      middlewares:
        - ip-whitelist


  services:
    service-immich:
      loadBalancer:
        servers:
          - url: "http://10.0.50.125:2283"
    
    # service-microbin:
    #   loadBalancer:
    #     servers:
    #       - url: "http://10.0.50.125:8080"

    # service-internal-dashboard:
    #   loadBalancer:
    #     servers:
    #       - url: "http://10.0.40.6:8080"

    service-nomad:
      loadBalancer:
        servers:
          - url: "http://nomad:4646"

    service-consul:
      loadBalancer:
        servers:
          - url: "http://consul:8500"


  middlewares:
    limitBodySize:
      buffering:
        maxRequestBodyBytes: 5000000000
    ip-whitelist:
      ipWhiteList:
        sourceRange:
          - "10.0.0.0/8"