---
- hosts: nomad_servers
  gather_facts: yes
  become: yes
  vars:
    nomad_type: server
    consul_type: client
    use_consul: true
  roles:
    - common
    - cis
    - ssh
    - consul
    - docker
    - nomad
    - nomad_cni_plugins
  tasks:
    - name: Copy folder to /opt/jobs
      ansible.builtin.copy:
        src: ../jobs  # Local folder on the Ansible controller
        dest: /opt/jobs            # Target directory on the node
        owner: root
        group: root
        mode: '0755'


- hosts: nomad_clients
  gather_facts: yes
  become: yes
  vars:
    nomad_type: client  # Nomad server/client
    consul_type: client # Consul server/client
    use_consul: true
  roles:
    - common
    - cis
    - ssh
    - consul
    - docker
    - nomad
    - nomad_cni_plugins